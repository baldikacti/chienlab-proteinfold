profiles {
    mycluster {
        process {
            // Maximum resources available in a node
            resourceLimits = [
            cpus: 192,
            memory: 2.TB,
            time: 14.d
            ]

            // Executor options
            executor = 'slurm'
            queueSize = 1000
            submitRateLimit = '20sec'
            pollInterval = '30sec'
            queueStatInterval = '1min'
            queue = { task.time <= 2.h ? 'cpu-preempt' : 'cpu' }
            clusterOptions = { "${task.time >= 48.h ? '-q long' : ''}" }

            // Process specific options
            withLabel:gpu {
                // If a process has gpu label submits to gpu queue
                queue = { task.time <= 2.h ? 'gpu-preempt' : 'gpu' }
                clusterOptions = { 
                    def vramConstraint = task.attempt == 1 ? 'vram23' : (task.attempt == 2 ? 'vram40' : 'vram80')
                    def smConstraint = params.mode == 'alphafold3' ? ',sm_80' : (params.mode == 'boltz' ? ',sm_70' : '')
                    return "--gpus=1 --constraint=${vramConstraint}${smConstraint}"
                }
                containerOptions = '--nv'

                cpus   = { 1                    }
                memory = { 30.GB * task.attempt }
                time   = { 8.h   * task.attempt }
            }
        
        }
    }
}